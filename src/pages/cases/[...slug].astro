---
import Base from "../../layouts/Base.astro";
import CourseCard from "../../components/CourseCard.astro";
import { getCollection, getEntry } from 'astro:content';
import { navigation, siteData } from "../../consts";
import slugify from "slugify";


export async function getStaticPaths() {
  const cases = await getCollection('cases');
  const promises = cases.map(async entry => {
    const courseId = slugify(entry.data.course);
    const course = await getEntry('courses', courseId);
    if(course === undefined) {
      throw new Error("Course is required");    // or: return Astro.redirect('/');
    }
    return {
      params: { slug: entry.slug }, props: { entry, course },
    }});
  return await Promise.all(promises);
}

const { entry, course } = Astro.props;
const { title, description, stakeholders } = entry.data;
const { Content } = await entry.render();
---
<Base {navigation} {siteData}>
  <div class="flex space-x-4 m-4">
    <CourseCard {...course.data}/>
    <CourseCard {...course.data}/>
    <CourseCard {...course.data}/>
    <CourseCard {...course.data}/>
    <CourseCard {...course.data}/>
  </div>
  <article class="py-32 prose container overflow-hidden px-10 lg:px-0 lg:max-w-4xl mx-auto
    prose-base md:prose-lg lg:prose-xl
    prose-lead:font-serif prose-lead:text-black dark:prose-lead:text-white
    prose-lead:first-letter:text-3xl
    prose-lead:md:first-letter:text-4xl
    prose-lead:lg:first-letter:text-5xl
    prose-lead:prose-lg md:prose-lead:prose-xl lg:prose-lead:prose-2xl
    dark:prose-invert
    md:prose-h1:text-6xl prose-h1:text-5xl
    prose-blockquote:font-normal prose-blockquote:not-italic
    prose-blockquote:border-secondary
    prose-a:no-underline prose-a:text-secondary-dark hover:prose-a:text-secondary-light
    " transition:name="content" transition:animate="slide">
    <h1>{title}</h1>
    <p>{ description }</p>
    { stakeholders.map(stakeholder => <p>{stakeholder}</p>) }
    <Content/>
  </article>
</Base>
