---
import Base from "@/layouts/Base.astro";
import Article from "@/components/Article.astro";
import CourseCard from "@/components/CourseCard";
import { getCollection } from 'astro:content';
import { getCourseByHabitat } from "@/db/courseDB";
import { navigation, siteData } from "@/consts";

export async function getStaticPaths() {
  const cases = await getCollection('cases');
  const promises = cases.map(async entry => {
    const course = await getCourseByHabitat(`/cases/${entry.slug}`);
    return {
      params: { slug: entry.slug }, props: { entry, course},
    }});

  return await Promise.all(promises);
}

const { entry, course } = Astro.props;
const { title, description } = entry.data;
const { Content } = await entry.render();
---
<Base {navigation} {siteData}>
  <div class="bg-white py-24 sm:py-32 mx-auto max-w-7xl">
    <div class="mx-auto grid max-w-2xl grid-cols-1 items-start gap-x-16 sm:gap-y-24 lg:mx-0 lg:max-w-none lg:grid-cols-[70%_30%]">
      <Article>
        <p class="text-base font-semibold leading-7 text-indigo-600">{title}</p>
        <h1>{title}</h1>
        <p>{description}</p>
        <Content />
      </Article>
      <div class="relative overflow-hidden lg:max-w-lg flex justify-center my-12 lg:m-0 lg:justify-start">
        { course && <CourseCard {...course} client:load/>}
      </div>
    </div>
  </div>
</Base>
